---
title: '[Re] Local alignment statistics - Compile Table 1 from Raw data'
author: "Nathan Brouwer"
date: "11/18/2019"
output:
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Analysis of all data

### Preliminaries

```{r}
#install.packages("extRemes")
library(extRemes)
```


### Load saved data
```{r}
load("~/1_R/git/blaststats/full_experiment.RData")
```


### Output from simulations

All data objects produced by each for loop

random.scores.191
random.scores.245
random.scores.314
random.scores.403
random.scores.518
random.scores.665
random.scores.854
random.scores.1097
random.scores.1408
random.scores.1808
random.scores.2322
random.scores.2981

### Get mean length of alignments

```{r}
l.191 <- mean(random.scores.191$length.i)
l.245 <- mean(random.scores.245$length.i)
l.314 <- mean(random.scores.314$length.i)
l.403 <- mean(random.scores.403$length.i)
l.518 <- mean(random.scores.518$length.i)
l.665 <- mean(random.scores.665$length.i)
l.854 <- mean(random.scores.854$length.i)
l.1097 <- mean(random.scores.1097$length.i)
l.1408 <- mean(random.scores.1408$length.i)
l.1808 <- mean(random.scores.1808$length.i)
l.2322 <- mean(random.scores.2322$length.i)
l.2981 <- mean(random.scores.2981$length.i)
```


### Fit Gumbel extreme value distribution model to each set of output

For each subexperiment (Each row of the table) a Gumbel EVD model is fit to the data.  This provides an estimate of mu and lambda.

```{r}
fit.gumbel.191 <- fevd(random.scores.191$score.i, 
                   type = "Gumbel",
                   method = "MLE")


fit.gumbel.245 <- fevd(random.scores.245$score.i, 
                   type = "Gumbel",
                   method = "MLE")


fit.gumbel.314 <- fevd(random.scores.314$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.403 <- fevd(random.scores.403$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.518 <- fevd(random.scores.518$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.665 <- fevd(random.scores.665$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.854 <- fevd(random.scores.854$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.1097 <- fevd(random.scores.1097$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.1408 <- fevd(random.scores.1408$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.1808 <- fevd(random.scores.1808$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.2322 <- fevd(random.scores.2322$score.i, 
                   type = "Gumbel",
                   method = "MLE")

fit.gumbel.2981 <- fevd(random.scores.2981$score.i,
                   type = "Gumbel",
                   method = "MLE")


```



### Get summary out from each model

THe "location" parameter is what the modeling function calls "mu".  The "Scale parameter" relates to lambda; lambda = 1/scale.  These can both be extracted from the output of the model.


All of the output from all of the models

fit.gumbel.191
fit.gumbel.245
fit.gumbel.314
fit.gumbel.403
fit.gumbel.518
fit.gumbel.665
fit.gumbel.854
fit.gumbel.1097
fit.gumbel.1408
fit.gumbel.1808
fit.gumbel.2322
fit.gumbel.2981

```{r}
# m = n = 191
## run summary on model
summary.gumbel.191 <- summary(fit.gumbel.191)

## extract location paramter
loc.param.191 <- summary.gumbel.191$par[1]

## extract and reformat scale paramter
scale.param.191  <- 1/summary.gumbel.191$par[2]

summary.gumbel.245 <- summary(fit.gumbel.245)
loc.param.245 <- summary.gumbel.245$par[1]
scale.param.245  <- 1/summary.gumbel.245$par[2]

summary.gumbel.314 <- summary(fit.gumbel.314)
loc.param.314 <- summary.gumbel.314$par[1]
scale.param.314  <- 1/summary.gumbel.314$par[2]

summary.gumbel.403 <- summary(fit.gumbel.403)
loc.param.403 <- summary.gumbel.403$par[1]
scale.param.403  <- 1/summary.gumbel.403$par[2]

summary.gumbel.518 <- summary(fit.gumbel.518)
loc.param.518 <- summary.gumbel.518$par[1]
scale.param.518  <- 1/summary.gumbel.518$par[2]

summary.gumbel.665 <- summary(fit.gumbel.665)
loc.param.665 <- summary.gumbel.665$par[1]
scale.param.665  <- 1/summary.gumbel.665$par[2]

summary.gumbel.854 <- summary(fit.gumbel.854)
loc.param.854 <- summary.gumbel.854$par[1]
scale.param.854  <- 1/summary.gumbel.854$par[2]

summary.gumbel.1097 <- summary(fit.gumbel.1097)
loc.param.1097  <- summary.gumbel.1097$par[1]
scale.param.1097  <- 1/summary.gumbel.1097$par[2]

summary.gumbel.1408 <- summary(fit.gumbel.1408)
loc.param.1408 <- summary.gumbel.1408$par[1]
scale.param.1408  <- 1/summary.gumbel.1408$par[2]

summary.gumbel.1808 <- summary(fit.gumbel.1808)
loc.param.1808 <- summary.gumbel.1808$par[1]
scale.param.1808  <- 1/summary.gumbel.1808$par[2]

summary.gumbel.2322 <- summary(fit.gumbel.2322)
loc.param.2322 <- summary.gumbel.2322$par[1]
scale.param.2322  <- 1/summary.gumbel.2322$par[2]

summary.gumbel.2981<- summary(fit.gumbel.2981)
loc.param.2981 <- summary.gumbel.2981$par[1]
scale.param.2981  <- 1/summary.gumbel.2981$par[2]

```



## Compile table from simulations



```{r}
# Sequences lengths used in the simulation
mn <- c(191,245,314,403,518,
        665,
        854,
        1097,
        1408,1808,2322,
        2981
        )

# mean lengths of ALIGNMETNS
lenght.l <- c(l.191 ,l.245 ,l.314 ,l.403 ,l.518 ,
              l.665,
              l.854 ,l.1097 ,
              l.1408 ,l.1808 ,l.2322 ,
              l.2981
              ) 

# mu (location) parameters from all of the models fit above
location.u <- c(loc.param.191,
                loc.param.245,
                loc.param.314,
                loc.param.403,
                loc.param.518,
                loc.param.665,
                loc.param.854,
                loc.param.1097,
                loc.param.1408,
                loc.param.1808,
                loc.param.2322,
                loc.param.2981
                )

# scale parameters (lambda) from all of the models
scale.lambda <- c(scale.param.191, 
                  scale.param.245,
                  scale.param.314,
                  scale.param.403,
                  scale.param.518, 
                  scale.param.665,
                  scale.param.854,
                  scale.param.1097,
                  scale.param.1408,
                  scale.param.1808,
                  scale.param.2322,
                  scale.param.2981
                  )


# comile table
table1.NLB <- data.frame(mn = mn, 
                   l = lenght.l,
           ln.mn = log(mn*mn), 
           mu = location.u, 
           lambda =scale.lambda
           )


```



## Calculate K 

Given the equations in Altschul and Gish we can calculate K directly from our estimates of lambda and mu

```{r}
table1.NLB$K <-  exp((location.u*scale.lambda) - log(mn*mn))
```

Look at table
```{r}
head(table1.NLB)
```

## Save table

```{r}
write.csv(table1.NLB, file = "table1NLB.csv")
```

Round off columns 
```{r}
# table1.NLB$ln.mn  <- round(table1.NLB$ln.mn, 3)
# table1.NLB$lenght.l     <- round(table1.NLB$l, 2)
# table1.NLB$mu     <- round(table1.NLB$mu, 2)
# table1.NLB$lambda <- round(table1.NLB$lambda, 3)
# table1.NLB$K      <- round(table1.NLB$K, 3)
```



```{r}

```

